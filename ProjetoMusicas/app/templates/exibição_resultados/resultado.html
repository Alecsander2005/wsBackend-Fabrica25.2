{% extends "base.html" %}

{% block title %}Busca de Músicas{% endblock %}

{% block content %}
<h1>Busca de Músicas</h1>

<a href="{% url 'listar_playlists' %}">Ver Playlists</a>

<form method="get">
    <input type="text" name="nome" placeholder="Digite o nome da música" required>
    <button type="submit">Buscar</button>
</form>

{% if mensagem %}
    <p class="mensagem">{{ mensagem }}</p>
{% endif %}

<h2>Resultados da Busca</h2>
{% for musica in musicas %}
    <div class="musica">
        <h3>{{ musica.titulo }}</h3>
        <p>Artista: {{ musica.artista }}</p>
        <p>Álbum: {{ musica.album }}</p>
        <p><a href="{{ musica.link }}" target="_blank">Ouvir no Deezer</a></p>

        <form method="post" action="{% url 'salvar_musica' %}">
            {% csrf_token %}
            <input type="hidden" name="titulo" value="{{ musica.titulo }}">
            <input type="hidden" name="artista" value="{{ musica.artista }}">
            <input type="hidden" name="album" value="{{ musica.album }}">
            <input type="hidden" name="link" value="{{ musica.link }}">
            <button type="submit">Salvar Música</button>
        </form>

        <form method="post" action="{% url 'adicionar_musica_busca' %}">
            {% csrf_token %}
            <input type="hidden" name="musica_titulo" value="{{ musica.titulo }}">
            <input type="hidden" name="musica_artista" value="{{ musica.artista }}">
            <input type="hidden" name="musica_album" value="{{ musica.album }}">
            <input type="hidden" name="musica_link" value="{{ musica.link }}">
            <select name="playlist_id" required>
                <option value="">Escolha uma playlist</option>
                {% for playlist in playlists %}
                    <option value="{{ playlist.id }}">{{ playlist.nome }}</option>
                {% endfor %}
            </select>
            <button type="submit">Adicionar à Playlist</button>
        </form>
    </div>
{% endfor %}

<a href="{% url 'musicas_salvas' %}">Ver Músicas Salvas</a>
{% endblock %}
